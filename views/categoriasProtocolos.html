<%- include('partials/head.html') %>
<%- include('partials/header.html') %>

    <div class="container mt-4" id="container-categoriasProtocolos">
    <!-- Campo de Busca -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Buscar categorias..." id="buscar-categorias">
                    <button class="btn btn-outline-secondary" type="button" id="button-addon2">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Lista de Categorias -->
        <div class="row">
            <div class="col-12">
                <h3>Categoria: <span id="nomeCat"></span></h3>
                <hr>
                <div class="list-group" id="lista-categoriasProtocolos">
                    
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para exibir o PDF -->
    <div class="modal fade" id="pdfModal" tabindex="-1" role="dialog" aria-labelledby="pdfModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pdfModalLabel">Visualizar Protocolo</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Fechar">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="pdfContainer"></div>
                    <!-- <canvas id="pdfCanvas" src="" width="100%" height="500px"></canvas> -->
                </div>
            </div>
        </div>
    </div>
<!-- <script src="categoriasProtocolos.js"></script> -->
<script src="pdfRenderer.js"></script>
<script>
    const idCategoria = "<%= idCategoria %>";
    $(document).ready(function(){
    $.ajax({
        url: `/api/categorias/protocolos/${idCategoria}`,
        method: 'GET',
        success: function(data) {
            $('#nomeCat').text(data[0].nomeCategoria);
            const protocolosList = $('#lista-categoriasProtocolos');
            data.forEach(protocolo => {
                const anexoUrl = `/uploads/${protocolo.anexo}`;
                protocolosList.append(`
                       <a href="#" class="view-pdf list-group-item list-group-item-action" data-url="${anexoUrl}">${protocolo.descricao}</a>
                    `);
            });
        },
        error: function(error) {
            console.error('Erro ao buscar protocolos:', error);
        }
    });
});

// Adicionar evento de clique para os links de visualização de PDF
$('#lista-categoriasProtocolos').on('click', '.view-pdf', function(e){
        e.preventDefault();
        const pdfUrl = $(this).data('url');
        console.log("pdfUrl", pdfUrl);
        if (pdfUrl === '/uploads/') {
            Swal.fire({
                icon: 'warning',
                title: 'Arquivo não encontrado',
                text: 'O arquivo PDF não está disponível.',
            });
        } else {
            renderPDF(pdfUrl);
            $('#pdfModal').modal('show');
        }
    });
</script>

<%- include('partials/footer.html') %>